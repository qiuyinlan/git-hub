# 第13章 文件输入/输出

## 文件
文件（file）通常是在磁盘或固态硬盘上的一段已命名的存储区。对我
们而言，stdio.h就是一个文件的名称，该文件中包含一些有用的信息。

> C把文件看作是一系列连续的字节，每个字节都能被单独读取。这与
UNIX环境中（C的发源地）的文件结构相对应。由于其他环境中可能无法完
全对应这个模型，C提供两种文件模式：文本模式和二进制模式。

> 文本模式
所有文件的内容都以二进制形式（0或1）储存
如果文件最初使用==二进制编码==的字符（例如， ASCII或Unicode）表示文本（就像C字符串那样），该文件就是文本文件，其中包含文本内容。

> 二进制模式
如果文件最初以==二进制形式==存储数据（例如，图像、音频或视频文件），该文件就是二进制文件，其中包含原始的二进制数据。
- 在文本模式下，文件被视为一系列的文本行，读取和写入过程中，可能会自动处理一些特定字符（如换行符、EOF）。
在二进制模式下，数据按原始二进制字节流的形式处理，文件中的每一个字节都会被精确地读出或写入。

## 文件I/O：fprintf()、fscanf()、fgets()和fputs()
fprintf()和 fscanf()的工作方式与 printf()和 scanf()类似。但是，与 putc()不同的是，fprintf()和fscanf()函数都把==FILE指针==作为第1个参数，而不是最后一个参数

- 标准输入流（stdin）：用于从用户或其他输入设备读取数据。
标准输出流（stdout）：用于输出程序的正常结果，通常输出到屏幕。
标准错误流（stderr）：用于输出错误信息和诊断消息，通常输出到屏幕，但也可以单独重定向。

> fprintf(stderr, "Usage: %s sourcefile targetfile\n", argv[0]);
如果 argc 的值不等于 3，程序会执行这个语句。
fprintf 是格式化输出函数，用于向指定的输出流（在这里是 stderr，标准错误流）写入内容。
stderr 用于输出错误消息或警告信息，而不是标准的输出流 stdout（标准输出流）。
"Usage: %s sourcefile targetfile\n" 是错误提示信息，告诉用户应该怎样正确运行程序。
%s 会被 argv[0]（程序的名字）替换，也就是提示用户：“Usage: copyfile sourcefile targetfile”。

> exit(EXIT_FAILURE);
如果参数数量不正确，程序会执行 exit(EXIT_FAILURE)，即终止程序并返回一个错误代码。
EXIT_FAILURE 是一个宏，表示程序执行失败。通常它的值是 1（不同操作系统可能会有不同的值），表示程序非正常终止。
exit 函数会立即终止程序，后续的代码不会被执行。
- EXIT_FAILURE 是在 C 标准库中的 <stdlib.h> 头文件中定义的宏。它表示程序执行失败的返回值，通常用于 main 函数的返回值，以指示程序的错误或异常终止。

- size_t bytes;：声明一个size_t类型的变量bytes，用于存储每次读写操作实际读取或写入的字节数。
FILE *source;：声明一个==指向FILE类型的指针==source，用于存储原始文件的文件指针。
FILE *target;：声明一个指向FILE类型的指针target，用于存储拷贝文件的文件指针。


- fopen 
```c
if ((source = fopen(argv[1], "rb")) == NULL)
```

 #### 1. `fopen(argv[1], "rb")`
- `fopen` 是 C 标准库中的函数，用于打开文件。它接受两个参数：
  - `argv[1]`：这是从命令行参数中传入的文件名。`argv` 是一个字符指针数组（`char *argv[]`），通常在 `main` 函数中定义。`argv[1]` 指向用户在命令行中输入的第一个参数，通常是文件的路径或名称。
  - `"rb"`：这是打开文件的模式。`"rb"` 表示以“二进制读取”模式打开文件，其中：
    - `"r"` 表示读取（read）模式。
    - `"b"` 表示二进制（binary）模式。

#### 2. `source = fopen(argv[1], "rb")`
- `fopen` 会返回一个指向 `FILE` 类型的指针。如果文件打开成功，`fopen` 会返回指向文件的指针；如果失败，则返回 `NULL`。
- 这里将 `fopen` 的返回值赋给指针变量 `source`，用于存储打开的文件指针。

 ####  3. `if ((source = fopen(argv[1], "rb")) == NULL)`
- `if` 语句用于检查 `fopen` 的返回值是否为 `NULL`。
- `== NULL` 表示如果文件打开失败（即 `fopen` 返回 `NULL`），条件为真，进入 `if` 语句的代码块，通常会执行一些错误处理（如打印错误信息或退出程序）。

-  总结
这一行代码的作用是尝试以二进制模式打开用户指定的文件，如果文件无法打开（如文件不存在或没有权限），则进入 `if` 语句的代码块，处理文件打开失败的情况。

fwrite(temp, sizeof(char), bytes, target);：使用fwrite函数将缓冲区temp中的数据写入到拷贝文件中，写入的字节数为bytes